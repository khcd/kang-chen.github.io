---
import Layout from "../../layouts/Layout.astro"
import BlogPost from "../../components/BlogPost.astro"

// getStaticPaths tells Astro which slugs to generate
export async function getStaticPaths() {
	const posts = await Astro.glob("../../content/posts/*.md")
	console.log("Found posts:", posts.length)
	console.log(
		"Post file paths:",
		posts.map((p) => p.file)
	)

	const paths = posts.map((post) => {
		// Extract filename from file path and remove .md extension
		const filename = post.file.split("/").pop().replace(/\.md$/, "")
		console.log(`File path: ${post.file}, Generated slug: ${filename}`)
		return { params: { slug: filename } }
	})
	console.log("Generated blog slugs:", paths)
	return paths
}

// Import all posts for use in the page
const posts = await Astro.glob("../../content/posts/*.md")

// Get the slug from the URL
const { slug } = Astro.params

// Find the post whose filename matches the slug
const post = posts.find((p) => {
	const filename = p.file.split("/").pop().replace(/\.md$/, "")
	return filename === slug
})

if (!post) {
	throw new Error(`Post not found for slug: ${slug}`)
}
---

<Layout>
	<BlogPost title={post.frontmatter.title} date={post.frontmatter.date}>
		<post.Content />
	</BlogPost>
</Layout>
